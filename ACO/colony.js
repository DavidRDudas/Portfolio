class Colony{constructor(t,e,s,i,o){this.x=t,this.y=e,this.width=s,this.height=i,this.color=o,this.ants=[],this.foodSources=[],this.foodStock=200,this.queenDead=!1,this.queenRespawnTimer=0,this.pheromoneSystem=new PheromoneSystem(s,i,o),this.enemySpawnTimer=0,this.debugMode=!1,this.age=0,this.deadAnts=[],this.logs=[],this.maxLogs=50,this.isExtinct=!1,this.foodSpawnTimer=0,this.foodSettings={spawnRate:300,maxSources:12,defaultAmount:150},this.antsBorn=0,this.enemySettings={enabled:!0,spawnRate:300,speed:1.5,damage:15,health:80}}initializeWithSettings(t){this.ants=[],this.antsBorn=1,this.ants.push(new Ant(this.x,this.y,"queen",this)),this.foodSettings={spawnRate:t.food.spawnRate,maxSources:t.food.maxSources,defaultAmount:t.food.amount},this.foodSources=[];for(let e=0;e<t.food.count;e++)this.addRandomFoodSource();this.enemySettings=t.enemy}update(t,e=1){if(this.isExtinct)return;this.age+=e;if(0===this.ants.filter((t=>!t.isDead&&!t.isEnemy)).length)return this.isExtinct=!0,this.addLog("Colony has gone extinct!","#FF4444"),void addNotification(`Colony ${colonies.indexOf(this)+1} has gone extinct!`,"#FF4444");this.ants.find((t=>"queen"===t.type&&!t.isDead))||this.queenDead||(this.queenDead=!0,this.queenRespawnTimer=0,addNotification(`Colony ${colonies.indexOf(this)+1}'s queen has died!`,"#FFA500")),this.ants=this.ants.filter((t=>!t.isDead)),this.ants.forEach((s=>s.update(t,e))),this.queenDead&&this.foodStock>=200&&(this.queenRespawnTimer++,this.queenRespawnTimer>500&&(this.respawnQueen(),this.addLog("A new queen has emerged!","#FFD700"),addNotification(`Colony ${colonies.indexOf(this)+1} has a new queen!`,"#FFD700"))),this.foodSources.filter((t=>t.amount>0)).length<3&&this.addFoodSource(),this.enemySettings.enabled&&(this.enemySpawnTimer++,this.enemySpawnTimer>this.enemySettings.spawnRate&&(this.spawnEnemy(),this.enemySpawnTimer=0)),this.age%2==0&&this.pheromoneSystem.update(),this.deadAnts.forEach((t=>{t.x+=.2*Math.random()-.1,t.y+=.2*Math.random()-.1})),this.foodSpawnTimer+=e,this.foodSpawnTimer>this.foodSettings.spawnRate&&this.foodSources.length<this.foodSettings.maxSources&&(this.addRandomFoodSource(),this.foodSpawnTimer=0),this.foodSources=this.foodSources.filter((t=>t.amount>0)),this.deadAnts=this.deadAnts.filter((t=>{if(t.isBeingCarried){if(Math.hypot(t.x-this.x,t.y-this.y)<10)return this.foodStock+=.5,!1}return!0})),colonies.forEach((t=>{t!==this&&this.handleColonyInteraction(t)}))}addAnt(t){const e=new Ant(this.x,this.y,t,this);return this.ants.push(e),this.antsBorn++,this.antsBorn%100==0&&addNotification(`Colony ${colonies.indexOf(this)+1} reached ${this.antsBorn} ants!`,"#90EE90"),e}respawnQueen(){this.foodStock>=200&&(this.ants.push(new Ant(this.x,this.y,"queen",this)),this.queenDead=!1,this.queenRespawnTimer=0,this.foodStock-=200)}spawnEnemy(){let t,e;switch(Math.floor(4*Math.random())){case 0:t=Math.random()*WORLD_WIDTH,e=0;break;case 1:t=WORLD_WIDTH,e=Math.random()*WORLD_HEIGHT;break;case 2:t=Math.random()*WORLD_WIDTH,e=WORLD_HEIGHT;break;case 3:t=0,e=Math.random()*WORLD_HEIGHT}t=Math.min(Math.max(t,20),WORLD_WIDTH-20),e=Math.min(Math.max(e,20),WORLD_HEIGHT-20);const s=new Ant(t,e,"enemy",this);s.isEnemy=!0,s.speed=this.enemySettings.speed,s.damage=this.enemySettings.damage,s.health=this.enemySettings.health,this.ants.push(s)}addFoodSource(){this.foodSources.push({x:Math.random()*this.width,y:Math.random()*this.height,amount:150,scale:1})}draw(t){this.pheromoneSystem.draw(t),this.foodSources.forEach((e=>{e.amount>0&&(t.beginPath(),t.arc(e.x,e.y,4*e.scale,0,2*Math.PI),t.fillStyle="#FFD700",t.fill(),this.debugMode&&(t.fillStyle="white",t.font="10px Arial",t.fillText(Math.floor(e.amount),e.x+8,e.y+4)))})),t.beginPath(),t.arc(this.x,this.y,15,0,2*Math.PI),t.fillStyle=this.color,t.fill(),this.ants.forEach((e=>{e.isDead||e.draw(t)})),this.deadAnts.forEach((e=>{e.isBeingCarried||(t.beginPath(),t.arc(e.x,e.y,3,0,2*Math.PI),t.fillStyle="#444444",t.fill())}))}getPheromones(t,e){return this.pheromoneSystem.getNearby(t,e)}addPheromone(t,e,s,i){this.pheromoneSystem.add(t,e,s,i)}addLog(t,e="rgba(255, 255, 255, 0.8)"){const s=Math.floor(this.age/60),i=`${Math.floor(s/60)}m ${s%60}s`;this.logs.unshift({message:`[${i}] ${t}`,color:e}),this.logs.length>this.maxLogs&&this.logs.pop()}addRandomFoodSource(){if(this.foodSources.length>=this.foodSettings.maxSources)return;let t,e;do{t=Math.random()*this.width,e=Math.random()*this.height}while(Math.hypot(t-this.x,e-this.y)<100);const s=[{amount:this.foodSettings.defaultAmount,scale:1,name:"Regular"},{amount:2*this.foodSettings.defaultAmount,scale:1.5,name:"Large"},{amount:.5*this.foodSettings.defaultAmount,scale:.7,name:"Small"}],i=s[Math.floor(Math.random()*s.length)];this.foodSources.push({x:t,y:e,amount:i.amount,scale:i.scale}),this.addLog(`New ${i.name} food source appeared (${i.amount} units)!`,"#90EE90")}handleColonyInteraction(t){const e=colonies.indexOf(this),s=colonies.indexOf(t);let i=0;this.ants.forEach((e=>{e.isDead||e.isEnemy||t.ants.forEach((t=>{if(!t.isDead&&!t.isEnemy){Math.hypot(e.x-t.x,e.y-t.y)<15&&(Math.random()<.5?(e.health-=20,e.health<=0&&(e.die(),i++)):(t.health-=20,t.health<=0&&(t.die(),i++)))}}))})),i>=5&&addNotification(`Major battle between Colony ${e+1} and ${s+1}! (${i} casualties)`,"#FF6B6B")}layEgg(){const t=["forager","warrior","scout"],e=t[Math.floor(Math.random()*t.length)];this.addAnt(e),this.colony.addLog(`Queen laid egg: ${e}`,"#FFD700")}}