class SpatialGrid{constructor(t,s,i){this.cellSize=i,this.cols=Math.ceil(t/i),this.rows=Math.ceil(s/i),this.grid=new Array(this.cols*this.rows).fill().map((()=>[]))}clear(){for(let t of this.grid)t.length=0}getCellIndex(t,s){const i=Math.floor(t/this.cellSize),l=Math.floor(s/this.cellSize);return i<0||i>=this.cols||l<0||l>=this.rows?-1:l*this.cols+i}addParticle(t){const s=this.getCellIndex(t.x,t.y);s>=0&&s<this.grid.length&&this.grid[s].push(t)}getAdjacentCells(t){if(t<0||t>=this.grid.length)return[];const s=t%this.cols,i=Math.floor(t/this.cols),l=[t];for(let e=-1;e<=1;e++)for(let h=-1;h<=1;h++){const r=s+e,o=i+h;if(r>=0&&r<this.cols&&o>=0&&o<this.rows){const s=o*this.cols+r;s!==t&&l.push(s)}}return l}getNearbyParticles(t){const s=this.getCellIndex(t.x,t.y);if(s<0)return[];const i=[],l=this.getAdjacentCells(s);for(let t of l)t>=0&&t<this.grid.length&&i.push(...this.grid[t]);return i}}