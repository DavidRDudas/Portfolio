document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("canvas");e.width=window.innerWidth,e.height=window.innerHeight;const t=new ColorWaveEngine(e,{fadeSpeed:.08,waveSpeed:.002,maxParticleSize:10,minParticleSize:2,neighborRadius:60});t.initialize(150);const n={particleCount:150,harmonicScale:1,waveSpeed:1,colorSpeed:1},a=new PerformanceMonitor;function i(e,t){document.querySelector(`#${e}`).nextElementSibling.textContent=t}e.addEventListener("mousemove",(n=>{if(n.buttons>0){const a=e.getBoundingClientRect(),i=n.clientX-a.left,c=n.clientY-a.top;t.particles.push(t.createParticle(i,c)),t.particles.length>t.config.maxParticles&&t.particles.shift()}})),e.addEventListener("touchmove",(n=>{n.preventDefault();const a=n.touches[0],i=e.getBoundingClientRect(),c=a.clientX-i.left,o=a.clientY-i.top;t.particles.push(t.createParticle(c,o)),t.particles.length>t.config.maxParticles&&t.particles.shift()}),{passive:!1}),function(){document.getElementById("particleCount").addEventListener("input",(e=>{n.particleCount=parseInt(e.target.value),i("particleCount",n.particleCount)})),document.getElementById("waveSpeed").addEventListener("input",(e=>{t.config.waveSpeed=parseFloat(e.target.value),i("waveSpeed",t.config.waveSpeed.toFixed(4))})),document.getElementById("fadeSpeed").addEventListener("input",(e=>{t.config.fadeSpeed=parseFloat(e.target.value),i("fadeSpeed",t.config.fadeSpeed.toFixed(2))})),document.getElementById("maxParticleSize").addEventListener("input",(e=>{t.config.maxParticleSize=parseInt(e.target.value),i("maxParticleSize",t.config.maxParticleSize)})),document.getElementById("neighborRadius").addEventListener("input",(e=>{t.config.neighborRadius=parseInt(e.target.value),i("neighborRadius",t.config.neighborRadius)})),document.getElementById("colorSpeed").addEventListener("input",(e=>{t.config.colorSpeed=parseFloat(e.target.value),i("colorSpeed",t.config.colorSpeed.toFixed(4))})),document.getElementById("maxParticles").addEventListener("input",(e=>{for(t.config.maxParticles=parseInt(e.target.value),n.particleCount=Math.min(n.particleCount,t.config.maxParticles),i("maxParticles",t.config.maxParticles);t.particles.length>t.config.maxParticles;)t.particles.shift()})),document.getElementById("showConnections").addEventListener("change",(e=>{t.config.showConnections=e.target.checked})),document.getElementById("connectionDistance").addEventListener("input",(e=>{t.config.connectionDistance=parseInt(e.target.value),i("connectionDistance",t.config.connectionDistance)})),document.getElementById("flockingEnabled").addEventListener("change",(e=>{t.config.flockingEnabled=e.target.checked})),document.getElementById("flockingForce").addEventListener("input",(e=>{t.config.flockingForce=parseFloat(e.target.value),i("flockingForce",t.config.flockingForce.toFixed(3))})),document.getElementById("flockingForce").value="0.005",t.config.flockingForce=.005,i("flockingForce","0.005"),document.getElementById("clearCanvas").addEventListener("click",(()=>{t.particles=[],t.trails.clear()})),document.getElementById("emergencyEnabled").addEventListener("change",(e=>{e.target.checked?t.triggerEmergencyMode():t.stopEmergencyMode()})),document.getElementById("showTrails").addEventListener("change",(e=>{t.config.showTrails=e.target.checked,e.target.checked||t.trails.clear()})),document.getElementById("trailLength").addEventListener("input",(e=>{t.config.trailLength=parseInt(e.target.value),i("trailLength",t.config.trailLength)})),document.getElementById("effectType").addEventListener("change",(e=>{t.setEffect(e.target.value),t.particles.forEach((e=>{e.dx=0,e.dy=0}))})),e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e.addEventListener("mousedown",(n=>{if(2===n.button){n.preventDefault();const a=e.getBoundingClientRect(),i=n.clientX-a.left,c=n.clientY-a.top;t.addAttractor(i,c,-1)}})),e.addEventListener("mousemove",(n=>{if(2===n.buttons){const a=e.getBoundingClientRect(),i=n.clientX-a.left,c=n.clientY-a.top;t.addAttractor(i,c,-1)}})),e.addEventListener("mouseup",(e=>{2===e.button&&t.clearAttractors()})),e.addEventListener("dblclick",(e=>{e.preventDefault(),t.triggerExplosion(e.clientX,e.clientY,1)})),document.getElementById("particleShape").addEventListener("change",(e=>{t.config.particleShape=e.target.value}));const a=document.getElementById("pauseButton");a.addEventListener("click",(()=>{t.togglePause(),a.textContent=t.isPaused?"Resume":"Pause"})),document.getElementById("showParticles").addEventListener("change",(e=>{t.showParticles=e.target.checked})),document.addEventListener("keydown",(e=>{"Space"===e.code&&(e.preventDefault(),t.togglePause(),a.textContent=t.isPaused?"Resume":"Pause")})),document.getElementById("patternType").addEventListener("change",(e=>{const n=t.particles.length;t.config.pattern=e.target.value,t.particles=t.generatePattern(e.target.value,n)})),document.getElementById("patternScale").addEventListener("input",(e=>{t.config.patternScale=parseFloat(e.target.value),i("patternScale",t.config.patternScale.toFixed(1))})),document.getElementById("behavior").addEventListener("change",(e=>{t.config.behavior=e.target.value,t.particles.forEach((e=>{t.resetParticleBehavior(e)}))})),document.getElementById("glowEffect").addEventListener("change",(e=>{t.config.glowEffect=e.target.checked})),document.getElementById("glowStrength").addEventListener("input",(e=>{t.config.glowStrength=parseInt(e.target.value),i("glowStrength",t.config.glowStrength)})),document.getElementById("pulseEffect").addEventListener("change",(e=>{t.config.pulseEffect=e.target.checked})),e.addEventListener("contextmenu",(e=>(e.preventDefault(),!1)))}(),document.getElementById("presets").addEventListener("change",(e=>{const n=t.presets[e.target.value];n&&(Object.assign(t.config,n),document.getElementById("waveSpeed").value=t.config.waveSpeed,document.getElementById("fadeSpeed").value=t.config.fadeSpeed,document.getElementById("colorSpeed").value=t.config.colorSpeed,i("waveSpeed",t.config.waveSpeed.toFixed(4)),i("fadeSpeed",t.config.fadeSpeed.toFixed(2)),i("colorSpeed",t.config.colorSpeed.toFixed(4)))})),function e(){t.update(),t.draw(),a.update(t.particles.length),requestAnimationFrame(e)}(),window.addEventListener("resize",(()=>{e.width=window.innerWidth,e.height=window.innerHeight}))}));class PerformanceMonitor{constructor(){this.fps=0,this.frames=0,this.lastTime=performance.now(),this.statsElement=document.getElementById("stats")}update(e){this.frames++;const t=performance.now(),n=t-this.lastTime;n>=1e3&&(this.fps=Math.round(1e3*this.frames/n),this.frames=0,this.lastTime=t,this.statsElement.textContent=`FPS: ${this.fps} | Particles: ${e}`)}}