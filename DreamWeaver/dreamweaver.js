class DreamWeaver{constructor(){this.canvas=document.getElementById("canvas"),this.input=document.getElementById("input"),this.canvas.setAttribute("viewBox","0 0 600 400"),this.debounceTimeout=null,this.debounceDelay=500,this.palettes={vibrant:["#FF0055","#FF9100","#FFF700","#00FF95","#00B8FF","#9C00FF"],muted:["#CFB5C0","#B4A6AB","#998B96","#7D7082","#62566D","#463B58"],earth:["#4A3F35","#6B5B4D","#8C7765","#AD937D","#CEB095","#EFCCAD"],ocean:["#001B3B","#003776","#0053B1","#006EEB","#2689FF","#4DA3FF"],forest:["#1B4B00","#366D00","#518F00","#6CB100","#87D300","#A2F500"],sunset:["#FF7B00","#FF5E00","#FF4100","#FF2400","#FF0700","#FF001F"],moonlight:["#FFFFFF","#E6E6FF","#CCCCFF","#B3B3FF","#9999FF","#8080FF"],aurora:["#00FF87","#00FFE1","#00E4FF","#00AAFF","#0055FF","#0000FF"]},this.blendModes=["multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light"],this.input.addEventListener("input",(t=>{" "!==this.input.value[this.input.value.length-1]&&this.debouncedGenerateArt()})),this.layerSettings={texture:!0,flowField:!0,mainShapes:!0,details:!0,highlights:!0,noise:!0,patterns:!0,voronoi:!0,particles:!0,lightRays:!0},this.initializeSettings(),this.totalLayers=11,this.currentLayer=0,this.convertToImage=this.convertToImage.bind(this)}initializeSettings(){const t=document.querySelector(".settings-toggle"),e=document.querySelector(".settings-content");t.addEventListener("click",(()=>{e.classList.toggle("hidden")})),document.querySelectorAll(".setting-item input").forEach((t=>{const e=t.dataset.layer;t.addEventListener("change",(()=>{this.layerSettings[e]=t.checked,this.generateArt()}))}))}debouncedGenerateArt(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((async()=>{" "!==this.input.value[this.input.value.length-1]&&await this.generateArt()}),this.debounceDelay)}updateProgress(t){const e=document.getElementById("loading"),s=e.querySelector(".progress"),a=e.querySelector(".loading-bar-fill"),n=Math.round(t/this.totalLayers*100);s.textContent=`${n}%`,a.style.width=`${n}%`}async generateArt(){const t=this.input.value,e=document.getElementById("loading");if(!t)return this.canvas.innerHTML="",void e.classList.add("hidden");if("img"===this.canvas.tagName.toLowerCase()){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id","canvas"),t.setAttribute("viewBox","0 0 600 400"),t.setAttribute("width","600"),t.setAttribute("height","400"),t.setAttribute("aria-label","Generated dream visualization"),t.style.borderRadius="12px",t.style.maxWidth="100%",this.canvas.replaceWith(t),this.canvas=t}this.currentLayer=0,this.updateProgress(0),e.classList.remove("hidden"),this.canvas.innerHTML="";const s=t;this.canvas.innerHTML="",this.currentSeed=this.hashText(s);const a=this.analyzeText(s);try{await this.generateBackground(a),this.currentLayer++,this.updateProgress(this.currentLayer),await new Promise((t=>setTimeout(t,50)));const t=[{enabled:this.layerSettings.texture,fn:()=>this.generateTextureLayer(a)},{enabled:this.layerSettings.flowField,fn:()=>this.generateFlowField(a)},{enabled:this.layerSettings.mainShapes,fn:()=>this.generateMainShapes(a)},{enabled:this.layerSettings.details,fn:()=>this.generateDetailLayer(a)},{enabled:this.layerSettings.highlights,fn:()=>this.generateHighlights(a)},{enabled:this.layerSettings.noise,fn:()=>this.applyNoiseFilter(a)},{enabled:this.layerSettings.patterns,fn:()=>this.generatePatternMesh(a)},{enabled:this.layerSettings.voronoi,fn:()=>this.generateVoronoiCells(a)},{enabled:this.layerSettings.particles,fn:()=>this.generateFlowParticles(a)},{enabled:this.layerSettings.lightRays,fn:()=>this.generateLightRays(a)}];for(const e of t)e.enabled&&(await new Promise((t=>{requestAnimationFrame((async()=>{await e.fn(),this.currentLayer++,this.updateProgress(this.currentLayer),t()}))})),await new Promise((t=>setTimeout(t,50))));await this.applyColorHarmonies(a),this.currentLayer++,this.updateProgress(this.currentLayer),await this.convertToImage()}catch(t){console.error("Error generating art:",t)}finally{this.updateProgress(this.totalLayers),await new Promise((t=>setTimeout(t,300))),e.classList.add("hidden")}}generateBackground(t){const e=this.palettes[this.selectPalette(t)],s=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),a="backgroundGradient";s.setAttribute("id",a),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","100%"),s.setAttribute("y2","100%");[{offset:"0%",color:e[0],opacity:.4},{offset:"50%",color:e[1],opacity:.3},{offset:"100%",color:e[2],opacity:.4}].forEach((t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","stop");e.setAttribute("offset",t.offset),e.setAttribute("stop-color",t.color),e.setAttribute("stop-opacity",t.opacity),s.appendChild(e)}));const n=this.canvas.querySelector("defs")||document.createElementNS("http://www.w3.org/2000/svg","defs");n.appendChild(s),this.canvas.querySelector("defs")||this.canvas.appendChild(n);const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width","600"),i.setAttribute("height","400"),i.setAttribute("fill",`url(#${a})`),this.canvas.appendChild(i)}generateTextureLayer(t){const e=Math.floor(50+200*this.seededRandom(0)),s=document.createElementNS("http://www.w3.org/2000/svg","g");for(let t=0;t<e;t++){const e=600*this.seededRandom(t),a=400*this.seededRandom(t+1),n=.5+2*this.seededRandom(t+2),i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",e),i.setAttribute("cy",a),i.setAttribute("r",n),i.setAttribute("fill","#000"),i.setAttribute("opacity",.05),s.appendChild(i)}this.canvas.appendChild(s)}generateFlowField(t){const e=this.palettes[this.selectPalette(t)],s=Math.min(100,5*t.complexity);for(let t=0;t<s;t++){const s=document.createElementNS("http://www.w3.org/2000/svg","path");let a=`M ${600*this.seededRandom(t)} ${400*this.seededRandom(t+1)}`;const n=10+Math.floor(10*this.seededRandom(t+2));let i=600*this.seededRandom(t),r=400*this.seededRandom(t+1);for(let e=0;e<n;e++){const s=this.seededRandom(t+3*e)*Math.PI*4,n=20+40*this.seededRandom(t+2*e),o=i+Math.cos(s)*n,h=r+Math.sin(s)*n;a+=` Q ${i+Math.cos(s)*n*.5} ${r+Math.sin(s)*n*.5} ${o} ${h}`,i=o,r=h}s.setAttribute("d",a),s.setAttribute("stroke",e[Math.floor(this.seededRandom(7*t)*e.length)]),s.setAttribute("stroke-width",.5+2*this.seededRandom(11*t)),s.setAttribute("fill","none"),s.setAttribute("opacity",.1+.2*this.seededRandom(13*t)),this.canvas.appendChild(s)}}generateMainShapes(t){const e=this.palettes[this.selectPalette(t)];t.words.forEach(((t,s)=>{const a=500*this.seededRandom(s)+50,n=300*this.seededRandom(s+1)+50,i=10+3*t.length;this.generateShapeCluster(a,n,i,t,s,e)}))}generateShapeCluster(t,e,s,a,n,i){const r=5*a.length;for(let a=0;a<r;a++){const r=this.seededRandom(n*a)*Math.PI*2,o=this.seededRandom(n*a+1)*s*2,h=t+Math.cos(r)*o,d=e+Math.sin(r)*o,l=s*(.2+.3*this.seededRandom(n*a+2));switch(Math.floor(4*this.seededRandom(n*a+3))){case 0:this.generateSpiralShape(h,d,l,n*a,i);break;case 1:this.generateCrystalShape(h,d,l,n*a,i);break;case 2:this.generateFlowerShape(h,d,l,n*a,i);break;case 3:this.generateStarburstShape(h,d,l,n*a,i)}}}generateSpiralShape(t,e,s,a,n){const i=document.createElementNS("http://www.w3.org/2000/svg","path");let r=`M ${t} ${e}`;const o=3+Math.floor(4*this.seededRandom(a)),h=20*o;for(let a=0;a<h;a++){const n=a/h*Math.PI*2*o,i=a/h*s;r+=` L ${t+Math.cos(n)*i} ${e+Math.sin(n)*i}`}i.setAttribute("d",r),i.setAttribute("stroke",n[Math.floor(this.seededRandom(a)*n.length)]),i.setAttribute("stroke-width",.5+this.seededRandom(a+1)),i.setAttribute("fill","none"),i.setAttribute("opacity",.3+.4*this.seededRandom(a+2)),this.canvas.appendChild(i)}generateCrystalShape(t,e,s,a,n){const i=6+Math.floor(4*this.seededRandom(a)),r=document.createElementNS("http://www.w3.org/2000/svg","path");let o="";for(let n=0;n<i;n++){const r=n/i*Math.PI*2,h=s*(.5+.5*this.seededRandom(a+n));o+=`${0===n?"M":"L"} ${t+Math.cos(r)*h} ${e+Math.sin(r)*h}`}o+="Z",r.setAttribute("d",o),r.setAttribute("fill",n[Math.floor(this.seededRandom(a)*n.length)]),r.setAttribute("opacity",.2+.3*this.seededRandom(a+1)),this.canvas.appendChild(r)}generateFlowerShape(t,e,s,a,n){const i=5+Math.floor(7*this.seededRandom(a)),r=document.createElementNS("http://www.w3.org/2000/svg","path");let o="";for(let n=0;n<i;n++){const r=n/i*Math.PI*2,h=(n+1)/i*Math.PI*2,d=s*(.8+.4*this.seededRandom(a+n)),l=t+Math.cos(r)*d,c=e+Math.sin(r)*d;0===n&&(o+=`M ${l} ${c}`),o+=` C ${t+Math.cos(r+Math.PI/4)*d*1.5} ${e+Math.sin(r+Math.PI/4)*d*1.5} ${t+Math.cos(h-Math.PI/4)*d*1.5} ${e+Math.sin(h-Math.PI/4)*d*1.5} ${t+Math.cos(h)*d} ${e+Math.sin(h)*d}`}o+="Z",r.setAttribute("d",o),r.setAttribute("fill",n[Math.floor(this.seededRandom(a)*n.length)]),r.setAttribute("opacity",.2+.3*this.seededRandom(a+1)),this.canvas.appendChild(r)}generateStarburstShape(t,e,s,a,n){const i=8+Math.floor(8*this.seededRandom(a)),r=document.createElementNS("http://www.w3.org/2000/svg","path");let o="";for(let n=0;n<2*i;n++){const r=n/(2*i)*Math.PI*2,h=s*(n%2==0?1:.3+.3*this.seededRandom(a+n));o+=`${0===n?"M":"L"} ${t+Math.cos(r)*h} ${e+Math.sin(r)*h}`}o+="Z",r.setAttribute("d",o),r.setAttribute("fill",n[Math.floor(this.seededRandom(a)*n.length)]),r.setAttribute("opacity",.2+.3*this.seededRandom(a+1)),this.canvas.appendChild(r)}generateConnectingLines(t){const e=this.palettes[this.selectPalette(t)],s=t.words;for(let t=0;t<s.length-1;t++){const s=500*this.seededRandom(t)+50,a=300*this.seededRandom(t+1)+50,n=500*this.seededRandom(t+1)+50,i=300*this.seededRandom(t+2)+50,r=document.createElementNS("http://www.w3.org/2000/svg","path"),o=`M ${s} ${a} Q ${(s+n)/2} ${(a+i)/2+50} ${n} ${i}`;r.setAttribute("d",o),r.setAttribute("stroke",e[t%e.length]),r.setAttribute("stroke-width","1"),r.setAttribute("fill","none"),r.setAttribute("opacity","0.3"),this.canvas.appendChild(r)}}generateParticles(t){const e=this.palettes[this.selectPalette(t)],s=Math.min(100,2*t.length);for(let t=0;t<s;t++){const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("cx",600*this.seededRandom(t)),s.setAttribute("cy",400*this.seededRandom(t+1)),s.setAttribute("r",1+3*this.seededRandom(t+2)),s.setAttribute("fill",e[t%e.length]),s.setAttribute("opacity","0.5"),this.canvas.appendChild(s)}}generateDetailLayer(t){t.words.forEach(((t,e)=>{this.generateFractalPattern(600*this.seededRandom(e),400*this.seededRandom(e+1),3,5*t.length,e)}))}generateFractalPattern(t,e,s,a,n){if(s<=0)return;const i=3+Math.floor(4*this.seededRandom(n)),r=this.palettes[this.selectPalette({complexity:s})];for(let o=0;o<i;o++){const h=o/i*Math.PI*2+this.seededRandom(n+o),d=.6*a,l=a*(.5+.5*this.seededRandom(n+o)),c=t+Math.cos(h)*l,u=e+Math.sin(h)*l,g=document.createElementNS("http://www.w3.org/2000/svg","path"),p=t+Math.cos(h)*l*.5+(this.seededRandom(n+o)-.5)*a,m=e+Math.sin(h)*l*.5+(this.seededRandom(n+o+1)-.5)*a;g.setAttribute("d",`M ${t} ${e} Q ${p} ${m} ${c} ${u}`),g.setAttribute("stroke",r[Math.floor(this.seededRandom(n+o)*r.length)]),g.setAttribute("stroke-width",.5*s),g.setAttribute("fill","none"),g.setAttribute("opacity",.3),this.canvas.appendChild(g),this.generateJunctionDecoration(c,u,.5*d,n+o,s),this.generateFractalPattern(c,u,s-1,d,n+o)}}generateJunctionDecoration(t,e,s,a,n){const i=Math.floor(4*this.seededRandom(a)),r=this.palettes[this.selectPalette({complexity:n})],o=r[Math.floor(this.seededRandom(a)*r.length)];switch(i){case 0:this.generateMandala(t,e,s,a,o);break;case 1:this.generateConcentricCircles(t,e,s,a,o);break;case 2:this.generateGeometricBurst(t,e,s,a,o);break;case 3:this.generateOrganicBlob(t,e,s,a,o)}}generateHighlights(t){const e=Math.floor(20+30*this.seededRandom(0)),s=this.palettes[this.selectPalette(t)];for(let t=0;t<e;t++){const e=600*this.seededRandom(t),a=400*this.seededRandom(t+1),n=5+15*this.seededRandom(t+2),i=document.createElementNS("http://www.w3.org/2000/svg","radialGradient"),r=`highlight-${t}`;i.setAttribute("id",r);const o=document.createElementNS("http://www.w3.org/2000/svg","stop");o.setAttribute("offset","0%"),o.setAttribute("stop-color",s[Math.floor(this.seededRandom(t)*s.length)]),o.setAttribute("stop-opacity","0.4");const h=document.createElementNS("http://www.w3.org/2000/svg","stop");h.setAttribute("offset","100%"),h.setAttribute("stop-color","#ffffff"),h.setAttribute("stop-opacity","0"),i.appendChild(o),i.appendChild(h),this.canvas.appendChild(i);const d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx",e),d.setAttribute("cy",a),d.setAttribute("r",n),d.setAttribute("fill",`url(#${r})`),this.canvas.appendChild(d)}}applyNoiseFilter(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g");for(let t=0;t<2e3;t++){const s=600*this.seededRandom(3*t),a=400*this.seededRandom(3*t+1),n=.2+.8*this.seededRandom(3*t+2),i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",s),i.setAttribute("cy",a),i.setAttribute("r",n),i.setAttribute("fill","#000"),i.setAttribute("opacity",.03),e.appendChild(i)}this.canvas.appendChild(e)}seededRandom(t){const e=Math.pow(2,32);return this.currentSeed=(1664525*(t+this.currentSeed)+1013904223)%e,this.currentSeed/e}hashText(t){return t.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0)}selectPalette(t){const e=Object.keys(this.palettes);return e[Math.abs(this.currentSeed)%e.length]}analyzeText(t){const e=t.split(" "),s=new Set(e).size,a=t.length/e.length;return{words:e,length:t.length,complexity:e.length*a*(s/e.length),uniqueRatio:s/e.length,avgWordLength:a,sentiment:0}}generateMandala(t,e,s,a,n){const i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=3+Math.floor(4*this.seededRandom(a)),o=6+Math.floor(12*this.seededRandom(a+1));for(let h=0;h<r;h++){const d=s*(.3+h/r*.7),l=document.createElementNS("http://www.w3.org/2000/svg","path");let c="";for(let s=0;s<=o;s++){const n=s/o*Math.PI*2,i=d*(.8+.4*this.seededRandom(a+h+s)),r=t+Math.cos(n)*i,l=e+Math.sin(n)*i;if(0===s)c+=`M ${r} ${l}`;else{const d=(s-1)/o*Math.PI*2,u=i*(1+.2*this.seededRandom(a+h+s));c+=` C ${t+Math.cos(d+Math.PI/o)*u} ${e+Math.sin(d+Math.PI/o)*u} ${t+Math.cos(n-Math.PI/o)*u} ${e+Math.sin(n-Math.PI/o)*u} ${r} ${l}`}}c+="Z",l.setAttribute("d",c),l.setAttribute("fill","none"),l.setAttribute("stroke",n),l.setAttribute("stroke-width",.5*(r-h)),l.setAttribute("opacity",.2+h/r*.3),i.appendChild(l)}this.canvas.appendChild(i)}generateConcentricCircles(t,e,s,a,n){const i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=4+Math.floor(4*this.seededRandom(a));for(let o=0;o<r;o++){const h=document.createElementNS("http://www.w3.org/2000/svg","circle"),d=s*((o+1)/r),l=document.createElementNS("http://www.w3.org/2000/svg","animate");l.setAttribute("attributeName","r"),l.setAttribute("values",`${.9*d};${1.1*d};${.9*d}`),l.setAttribute("dur",2+3*this.seededRandom(a+o)+"s"),l.setAttribute("repeatCount","indefinite"),h.setAttribute("cx",t),h.setAttribute("cy",e),h.setAttribute("r",d),h.setAttribute("fill","none"),h.setAttribute("stroke",n),h.setAttribute("stroke-width",.5),h.setAttribute("opacity",.1+o/r*.2),h.appendChild(l),i.appendChild(h)}this.canvas.appendChild(i)}generateGeometricBurst(t,e,s,a,n){const i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=8+Math.floor(8*this.seededRandom(a)),o=2+Math.floor(3*this.seededRandom(a+1));for(let h=0;h<o;h++){const d=s*(.5+h/o*.5);for(let s=0;s<r;s++){const l=s/r*Math.PI*2,c=document.createElementNS("http://www.w3.org/2000/svg","path"),u=.3*d,g=d*(.8+.4*this.seededRandom(a+s)),p=2*Math.PI/r*(.3+.4*this.seededRandom(a+s+h)),m=t+Math.cos(l-p)*u,w=e+Math.sin(l-p)*u,b=t+Math.cos(l+p)*u,f=e+Math.sin(l+p)*u,M=t+Math.cos(l+p/2)*g,y=e+Math.sin(l+p/2)*g;c.setAttribute("d",`M ${m} ${w} L ${b} ${f} L ${M} ${y} Z`),c.setAttribute("fill",n),c.setAttribute("opacity",.1+h/o*.2),i.appendChild(c)}}this.canvas.appendChild(i)}generateOrganicBlob(t,e,s,a,n){const i=document.createElementNS("http://www.w3.org/2000/svg","path"),r=8+Math.floor(8*this.seededRandom(a));let o="";const h=[];for(let n=0;n<r;n++){const i=n/r*Math.PI*2,o=s*(.5+.5*this.seededRandom(a+n)),d=t+Math.cos(i)*o,l=e+Math.sin(i)*o;h.push({x:d,y:l})}h.push({...h[0]}),h.push({...h[1]}),o+=`M ${h[0].x} ${h[0].y}`;for(let t=0;t<r;t++){const e=h[t],n=h[t+1],i=h[t+2];o+=` C ${e.x+.5*(n.x-e.x)+(this.seededRandom(a+t)-.5)*s*.3} ${e.y+.5*(n.y-e.y)+(this.seededRandom(a+t+1)-.5)*s*.3} ${n.x+.5*(i.x-n.x)+(this.seededRandom(a+t+2)-.5)*s*.3} ${n.y+.5*(i.y-n.y)+(this.seededRandom(a+t+3)-.5)*s*.3} ${n.x} ${n.y}`}const d=2+Math.floor(3*this.seededRandom(a));for(let n=0;n<d;n++){const i=Math.floor(this.seededRandom(a+n)*r),d=Math.floor(this.seededRandom(a+n+1)*r),l=h[i],c=h[d];o+=` M ${l.x} ${l.y}`,o+=` Q ${t+(this.seededRandom(a+n)-.5)*s} ${e+(this.seededRandom(a+n+1)-.5)*s} ${c.x} ${c.y}`}i.setAttribute("d",o),i.setAttribute("fill",n),i.setAttribute("opacity",.2),i.setAttribute("stroke",n),i.setAttribute("stroke-width",.5),this.canvas.appendChild(i)}generatePatternMesh(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=Math.ceil(30),a=Math.ceil(20);for(let t=0;t<s;t++)for(let s=0;s<a;s++){const n=20*t,i=20*s,r=t*a+s+this.currentSeed;if(this.seededRandom(r)>.7){const t=this.generateMicroPattern(n,i,20,r);e.appendChild(t)}}e.setAttribute("opacity","0.3"),this.canvas.appendChild(e)}generateMicroPattern(t,e,s,a){const n=document.createElementNS("http://www.w3.org/2000/svg","path");let i="";switch(Math.floor(5*this.seededRandom(a))){case 0:i=this.generateCrosshatch(t,e,s,a);break;case 1:i=this.generateDotPattern(t,e,s,a);break;case 2:i=this.generateWavePattern(t,e,s,a);break;case 3:i=this.generateZigzagPattern(t,e,s,a);break;case 4:i=this.generateSpiralPattern(t,e,s,a)}return n.setAttribute("d",i),n.setAttribute("stroke",this.getPatternColor(a)),n.setAttribute("stroke-width","0.5"),n.setAttribute("fill","none"),n}generateVoronoiCells(t){const e=[],s=10+Math.floor(15*this.seededRandom(0));for(let t=0;t<s;t++)e.push({x:600*this.seededRandom(t),y:400*this.seededRandom(t+1)});const a=this.computeVoronoi(e),n=document.createElementNS("http://www.w3.org/2000/svg","g");a.forEach(((t,e)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",this.cellToPath(t)),s.setAttribute("fill",this.getPatternColor(e)),s.setAttribute("opacity","0.1"),n.appendChild(s)})),this.canvas.appendChild(n)}generateFlowParticles(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=100+Math.floor(200*this.seededRandom(0));for(let t=0;t<s;t++){const s=this.createFlowParticle(t);e.appendChild(s)}this.canvas.appendChild(e)}createFlowParticle(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=600*this.seededRandom(t),a=400*this.seededRandom(t+1),n=1+3*this.seededRandom(t+2),i=document.createElementNS("http://www.w3.org/2000/svg","path");let r=`M ${s} ${a}`,o=s,h=a;for(let e=0;e<5;e++){const s=this.seededRandom(t+e)*Math.PI*2,a=5+15*this.seededRandom(t+e+1);o+=Math.cos(s)*a,h+=Math.sin(s)*a,r+=` L ${o} ${h}`}return i.setAttribute("d",r),i.setAttribute("stroke",this.getPatternColor(t)),i.setAttribute("stroke-width",n),i.setAttribute("opacity","0.3"),e.appendChild(i),e}generateLightRays(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=10+Math.floor(20*this.seededRandom(0)),a=300+200*(this.seededRandom(1)-.5),n=200+200*(this.seededRandom(2)-.5);for(let t=0;t<s;t++){const s=this.createLightRay(a,n,t);e.appendChild(s)}e.setAttribute("opacity","0.2"),this.canvas.appendChild(e)}createLightRay(t,e,s){const a=document.createElementNS("http://www.w3.org/2000/svg","path"),n=s/10*Math.PI*2,i=300+200*this.seededRandom(s),r=10+20*this.seededRandom(s+1),o=t+Math.cos(n)*i,h=e+Math.sin(n)*i,d=t+Math.cos(n)*i*.3,l=e+Math.sin(n)*i*.3,c=t+Math.cos(n)*i*.6,u=e+Math.sin(n)*i*.6;return a.setAttribute("d",`M ${t} ${e} C ${d} ${l} ${c} ${u} ${o} ${h}`),a.setAttribute("stroke",this.getPatternColor(s)),a.setAttribute("stroke-width",r),a.setAttribute("fill","none"),a}applyColorHarmonies(t){const e=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","filter");s.setAttribute("id","colorAdjust");const a=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix"),n=this.calculateColorHarmony(t);a.setAttribute("type","matrix"),a.setAttribute("values",n.join(" ")),s.appendChild(a),e.appendChild(s),this.canvas.appendChild(e);const i=document.createElementNS("http://www.w3.org/2000/svg","g");for(i.setAttribute("filter","url(#colorAdjust)");this.canvas.firstChild;)i.appendChild(this.canvas.firstChild);this.canvas.appendChild(i)}calculateColorHarmony(t){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],s=t.sentiment||0,a=t.complexity||1;return e[0]+=.2*s,e[6]+=.1*a,e[12]+=-.1*s,e}generateCrosshatch(t,e,s,a){const n=s/4;let i="";for(let a=0;a<4;a++){const r=a*n;i+=`M ${t} ${e+r} L ${t+s} ${e+r} `}for(let a=0;a<4;a++){const r=a*n;i+=`M ${t+r} ${e} L ${t+r} ${e+s} `}return i}generateDotPattern(t,e,s,a){let n="";const i=s/3;for(let a=0;a<3;a++)for(let r=0;r<3;r++){const o=s/20;n+=`M ${t+a*i+i/2} ${e+r*i+i/2} m -${o}, 0 a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0 `}return n}generateWavePattern(t,e,s,a){let n="";const i=s/8,r=2*Math.PI*2;n+=`M ${t} ${e+s/2}`;for(let a=0;a<=s;a+=s/20){n+=` L ${t+a} ${e+s/2+i*Math.sin(a/s*r)}`}return n}generateZigzagPattern(t,e,s,a){let n="";const i=s/4;n+=`M ${t} ${e}`;for(let a=0;a<4;a++){n+=` L ${t+a*i} ${a%2==0?e:e+s} L ${t+(a+1)*i} ${a%2==0?e+s:e}`}return n}generateSpiralPattern(t,e,s,a){let n="";n+=`M ${t+s/2} ${e+s/2}`;for(let a=0;a<=20;a++){const i=a/20*Math.PI*2*3,r=a/20*s/2;n+=` L ${t+s/2+Math.cos(i)*r} ${e+s/2+Math.sin(i)*r}`}return n}getPatternColor(t){const e=this.palettes[Object.keys(this.palettes)[t%Object.keys(this.palettes).length]];return e[t%e.length]}computeVoronoi(t){const e=[];for(let s=0;s<600;s+=20)for(let a=0;a<400;a+=20){let n=1/0,i=null;for(const e of t){const t=this.distance(s,a,e.x,e.y);t<n&&(n=t,i=e)}if(i){const t=e.find((t=>t.point===i));t?t.points.push({x:s,y:a}):e.push({point:i,points:[{x:s,y:a}]})}}return e}distance(t,e,s,a){return Math.sqrt(Math.pow(s-t,2)+Math.pow(a-e,2))}cellToPath(t){if(!t.points||0===t.points.length)return"";const e=this.getConvexHull(t.points);let s=`M ${e[0].x} ${e[0].y}`;for(let t=1;t<e.length;t++)s+=` L ${e[t].x} ${e[t].y}`;return s+="Z",s}getConvexHull(t){if(t.length<3)return t;let e=t[0];for(let s=1;s<t.length;s++)(t[s].y<e.y||t[s].y===e.y&&t[s].x<e.x)&&(e=t[s]);const s=t.filter((t=>t!==e)).sort(((t,s)=>Math.atan2(t.y-e.y,t.x-e.x)-Math.atan2(s.y-e.y,s.x-e.x))),a=[e];for(const t of s){for(;a.length>=2&&!this.isLeftTurn(a[a.length-2],a[a.length-1],t);)a.pop();a.push(t)}return a}isLeftTurn(t,e,s){return(e.x-t.x)*(s.y-t.y)-(e.y-t.y)*(s.x-t.x)>0}async convertToImage(){const t=(new XMLSerializer).serializeToString(this.canvas),e=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(e);return new Promise(((t,e)=>{const a=new Image;a.onload=()=>{const e=document.createElement("canvas");e.width=600,e.height=400;e.getContext("2d").drawImage(a,0,0);const n=document.createElement("img");n.src=e.toDataURL("image/png"),n.width=600,n.height=400,n.style.borderRadius="12px",n.style.maxWidth="100%",this.canvas.replaceWith(n),this.canvas=n,URL.revokeObjectURL(s),t()},a.onerror=e,a.src=s}))}}const dreamWeaver=new DreamWeaver;