class CodeAnalyzer{constructor(t){this.code=t,this.metrics={functions:[],variables:[],loops:[],conditionals:[],dependencies:new Map,variableDependencies:new Map}}analyze(){const t=/function\s+(\w+)\s*\(([^)]*)\)\s*{([^}]*)}/g;let s;for(;null!==(s=t.exec(this.code));){const[t,i,e,a]=s,h=this.calculateComplexity(a),n=this.generateHash(i+a);this.metrics.functions.push({name:i,params:e.split(",").map((t=>t.trim())).filter((t=>t)),complexity:h,hash:n,position:this.calculatePosition(n),size:10+2*h,color:this.generateColor(n),body:a})}const i=/(var|let|const)\s+(\w+)\s*=\s*([^;]+)/g;for(;null!==(s=i.exec(this.code));){const[t,i,e,a]=s,h=this.generateHash(e+a);this.metrics.variables.push({name:e,kind:i,hash:h,position:this.calculatePosition(h),size:"const"===i?8:6,color:this.generateVariableColor(i,h)})}return this.analyzeDependencies(),this.metrics}calculateComplexity(t){let s=1;return s+=(t.match(/if|while|for|switch/g)||[]).length,s+=.5*(t.match(/&&|\|\|/g)||[]).length,s+=.2*(t.match(/\./g)||[]).length,Math.ceil(s)}generateHash(t){let s=0;for(let i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i),s|=0;return s}calculatePosition(t){const s=Math.PI*(3-Math.sqrt(5)),i=Math.abs(t)%100,e=30*Math.sqrt(i),a=i*s;return{angle:a,radius:e,x:Math.cos(a)*e,y:Math.sin(a)*e}}generateColor(t){return`hsl(${Math.abs(t)%360}, 70%, 60%)`}generateVariableColor(t,s){return`hsl(${(({const:210,let:150,var:280}[t]||0)+Math.abs(s)%40-20)%360}, 70%, 60%)`}analyzeDependencies(){this.metrics.functions.forEach((t=>{const s=new Set,i=new Set;this.metrics.functions.forEach((i=>{t.name!==i.name&&new RegExp(`\\b${i.name}\\b`).test(t.body)&&s.add(i.name)})),this.metrics.variables.forEach((s=>{new RegExp(`\\b${s.name}\\b`).test(t.body)&&i.add(s.name)})),this.metrics.dependencies.set(t.name,s),this.metrics.variableDependencies.set(t.name,i)}))}}class BackgroundStar{constructor(t){this.canvas=t,this.reset(),this.z=2*Math.random()}reset(){this.x=Math.random()*this.canvas.width,this.y=Math.random()*this.canvas.height,this.size=1.5*Math.random(),this.opacity=Math.random()}update(){this.opacity=.2+.4*(Math.sin(.001*Date.now()*this.z)+1),Math.random()<.001&&(this.size=1.5*Math.random())}draw(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=`rgba(255, 255, 255, ${this.opacity})`,t.fill()}}class Planet{constructor(t,s,i){this.name=t.name,this.canvas=s,this.size=t.size||4,this.color=t.color,this.parentStar=i;const e=this.generateSeed(this.name+i.name);this.orbitRadius=30+40*e,this.angle=e*Math.PI*2,this.speed=.005+.01*e,this.orbitOffset=e*Math.PI*2}generateSeed(t){let s=0;for(let i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i),s|=0;return Math.abs(s)%1e3/1e3}update(){this.angle+=this.speed,this.x=this.parentStar.x+Math.cos(this.angle)*this.orbitRadius,this.y=this.parentStar.y+Math.sin(this.angle)*this.orbitRadius}draw(t){t.beginPath(),t.arc(this.parentStar.x,this.parentStar.y,this.orbitRadius,0,2*Math.PI),t.strokeStyle=`${this.color.replace(")",", 0.1)")}`,t.stroke(),t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.font="12px Arial",t.textAlign="center",t.fillText(this.name,this.x,this.y+this.size+15)}}class Physics{static applyForce(t,s){const i=s.x-t.x,e=s.y-t.y,a=Math.sqrt(i*i+e*e);if(a<50)return;const h=t.size*s.size/(a*a)*.05,n=Math.atan2(e,i);return{x:Math.cos(n)*h,y:Math.sin(n)*h}}static updateVelocity(t,s,i=.98){t.vx||(t.vx=0),t.vy||(t.vy=0),t.vx+=s.x,t.vy+=s.y,t.vx*=i,t.vy*=i}static updatePosition(t){t.x+=t.vx,t.y+=t.vy}}class Star{constructor(t,s){this.name=t.name,this.canvas=s,this.size=t.size||15,this.color=t.color,this.x=s.width/2+t.position.x,this.y=s.height/2+t.position.y,this.vx=0,this.vy=0,this.mass=this.size,this.pulseSpeed=.05,this.time=100*Math.random(),this.baseSize=this.size}update(t){t.forEach((t=>{if(t!==this&&t instanceof Star){const s=Physics.applyForce(this,t);s&&Physics.updateVelocity(this,s)}})),Physics.updatePosition(this);const s=2*this.size;(this.x<s||this.x>this.canvas.width-s)&&(this.vx*=-.8,this.x=Math.max(s,Math.min(this.x,this.canvas.width-s))),(this.y<s||this.y>this.canvas.height-s)&&(this.vy*=-.8,this.y=Math.max(s,Math.min(this.y,this.canvas.height-s))),this.time+=this.pulseSpeed,this.size=this.baseSize+2*Math.sin(this.time)}draw(t){(isNaN(this.x)||isNaN(this.y))&&(this.x=this.canvas.width/2,this.y=this.canvas.height/2);const s=t.createRadialGradient(this.x,this.y,0,this.x,this.y,4*this.size);s.addColorStop(0,this.color),s.addColorStop(.4,this.color.replace(")",", 0.25)")),s.addColorStop(1,this.color.replace(")",", 0)")),t.beginPath(),t.arc(this.x,this.y,4*this.size,0,2*Math.PI),t.fillStyle=s,t.fill(),t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.fillStyle="white",t.shadowColor=this.color,t.shadowBlur=10,t.font=`${Math.max(12,this.size)}px Arial`,t.textAlign="center",t.fillText(this.name,this.x,this.y+2*this.size),t.shadowBlur=0}}class Nebula{constructor(t,s,i){this.x=t,this.y=s,this.canvas=i,this.size=100+100*Math.random(),this.hue=360*Math.random(),this.opacity=.05,this.time=100*Math.random()}update(){this.time+=.002,this.size=100+20*Math.sin(this.time)}draw(t){const s=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size);s.addColorStop(0,`hsla(${this.hue}, 70%, 50%, ${this.opacity})`),s.addColorStop(1,`hsla(${this.hue}, 70%, 50%, 0)`),t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=s,t.fill()}}class Particle{constructor(t,s,i){this.x=t,this.y=s,this.color=i,this.size=1.5*Math.random(),this.speedX=.5*(Math.random()-.5),this.speedY=.5*(Math.random()-.5),this.life=1}update(){this.x+=this.speedX,this.y+=this.speedY,this.life-=.01}draw(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=`${this.color}${Math.floor(255*this.life).toString(16).padStart(2,"0")}`,t.fill()}}class Universe{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.objects=[],this.connections=[],this.backgroundStars=[],this.nebulas=[],this.resize(),this.createBackgroundStars()}resize(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.createBackgroundStars()}createBackgroundStars(){const t=Math.floor(this.canvas.width*this.canvas.height/1e3);this.backgroundStars=Array.from({length:t},(()=>new BackgroundStar(this.canvas)))}generate(t){const s=new CodeAnalyzer(t).analyze();this.objects=[],this.connections=[],this.nebulas=[];const i=s.functions.map((t=>{const s=new Star(t,this.canvas);return this.objects.push(s),s}));s.variables.forEach((t=>{let e=null;for(const a of i)if(s.variableDependencies.get(a.name).has(t.name)){e=a;break}e||(e={x:this.canvas.width/2,y:this.canvas.height/2,name:"center"});const a=new Planet(t,this.canvas,e);this.objects.push(a)})),s.dependencies.forEach(((t,s)=>{t.forEach((t=>{this.connections.push({source:this.objects.find((t=>t.name===s)),target:this.objects.find((s=>s.name===t))})}))})),s.functions.forEach((t=>{t.complexity>2&&this.nebulas.push(new Nebula(this.canvas.width/2+t.position.x,this.canvas.height/2+t.position.y,this.canvas))})),this.isAnimating||(this.isAnimating=!0,this.animate())}animate(){this.ctx.fillStyle="rgba(0, 0, 0, 0.15)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.objects.forEach((t=>{t.update(this.objects)})),this.nebulas.forEach((t=>t.draw(this.ctx))),this.backgroundStars.forEach((t=>t.draw(this.ctx))),this.connections.forEach((t=>{if(t.source&&t.target){const s=(t.source.x+t.target.x)/2,i=(t.source.y+t.target.y)/2;this.ctx.beginPath(),this.ctx.moveTo(t.source.x,t.source.y),this.ctx.quadraticCurveTo(s,i,t.target.x,t.target.y),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.stroke()}})),this.objects.forEach((t=>t.draw(this.ctx))),requestAnimationFrame((()=>this.animate()))}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("universe"),s=new Universe(t);document.getElementById("generate").addEventListener("click",(()=>{const t=document.getElementById("code-input").value;s.generate(t)})),window.addEventListener("resize",(()=>s.resize()))}));